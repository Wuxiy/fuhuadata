<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
        "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="MARKETTRAINING">
    <typeAlias alias="MarketTraining" type="com.fuhuadata.domain.MarketTraining"/>
    <typeAlias alias="MarketTrainingQuery" type="com.fuhuadata.domain.query.MarketTrainingQuery"/>
    <resultMap id="MARKETTRAINING-MAP" class="MarketTraining"  >
        <result column="tran_id" property="tranId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="product_id" property="productId" jdbcType="INTEGER" javaType="java.lang.Integer"/>
        <result column="title" property="title" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result column="product_type" property="productType" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result column="user_id" property="userId" jdbcType="INTEGER" javaType="java.lang.Integer" />
        <result column="user_name" property="userName" jdbcType="VARCHAR" javaType="java.lang.String"/>
        <result column="upload_date" property="uploadDate" jdbcType="DATE" javaType="java.sql.Date" />
        <result column="download" property="download" jdbcType="VARCHAR" javaType="java.lang.String"/>
    </resultMap>
    <sql id="PAGE-COMMON">
        <dynamic prepend=" WHERE ">
            <isNotNull prepend=" AND " property="productId">
                product_id = #productId#
            </isNotNull>
            <isNotNull prepend=" AND " property="title">
                title = #title#
            </isNotNull>
            <isNotNull prepend=" AND " property="productType">
                product_type like concat('%',#productType#,'%')
            </isNotNull>
            <isNotNull prepend=" AND " property="uploadDate">
                uploadDate = #uploadDate#
            </isNotNull>
            <isNotNull prepend=" AND " property="searchKey">
                title like concat('%',#searchKey#,'%')
            </isNotNull>
        </dynamic>
    </sql>
    <sql id="QUERY-COMMON">
        <dynamic prepend=" WHERE ">
            <isNotNull prepend=" AND " property="userId">
                user_id=#userId#
            </isNotNull>
        </dynamic>
    </sql>

        <insert id="ADD" parameterClass="MarketTraining" >
            insert into k_market_training (tran_id, product_id, title,
            product_type, user_id, upload_date,
            download)
            values (#tranId#, #productId#, #title#,
            #productType#, #userId#, #uploadDate#,
            #download#)
            <selectKey resultClass="int" keyProperty="tranId">
                SELECT @@IDENTITY AS tran_id
            </selectKey>
        </insert>

    <update id="UPDATE" parameterClass="MarketTraining">
        UPDATE k_market_training
        <dynamic prepend=" SET ">
            <isNotNull prepend=", " property="productId">
                product_id = #productId#
            </isNotNull>
            <isNotNull prepend=", " property="title">
                title = #title#
            </isNotNull>
            <isNotNull prepend=", " property="productType">
                product_type like concat('%',#productType#,'%')
            </isNotNull>
            <isNotNull prepend=", " property="uploadDate">
                uploadDate = #uploadDate#
            </isNotNull>
            <isNotNull prepend=", " property="userId">
                user_id = #userId#
            </isNotNull>
            <isNotNull prepend=", " property="download">
                download = #download#
            </isNotNull>
        </dynamic>
    </update>

    <delete id="DELETE-BY-ID" parameterClass="java.lang.Integer">
        <![CDATA[
        DELETE FROM k_market_training WHERE tran_id=#tranId#
        ]]>
    </delete>

    <select id="GET-BY-ID" resultMap="MARKETTRAINING-MAP" parameterClass="java.lang.Integer">
        <![CDATA[
        SELECT * FROM k_market_training WHERE tran_id = #id#
        ]]>
    </select>

    <select id="GET-BY-QUERY" resultMap="MARKETTRAINING-MAP" parameterClass="MarketTrainingQuery">
        <![CDATA[
        SELECT * FROM k_market_training
        ]]>
        <isParameterPresent>
            <include refid="QUERY-COMMON"/>
        </isParameterPresent>
    </select>

    <select id="GET-PAGE" resultMap="MARKETTRAINING-MAP" parameterClass="MarketTrainingQuery">
        <![CDATA[
        SELECT * FROM k_market_training
        ]]>
        <isParameterPresent>
            <include refid="PAGE-COMMON"/>
        </isParameterPresent>
        LIMIT #startRow#,#pageSize#
    </select>

    <select id="COUNT" resultClass="java.lang.Integer" parameterClass="MarketTrainingQuery">
        <![CDATA[
        SELECT COUNT(*) FROM k_market_training
        ]]>
        <isParameterPresent>
            <include refid="PAGE-COMMON"/>
        </isParameterPresent>
    </select>
</sqlMap>


