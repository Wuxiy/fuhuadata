<!--副导航-->
<div class="nav-deputy shadow-out clearfix">
    <ul id="myTab" class="nav nav-tabs pull-left">
        <li class="active"><a href="#areaRanking" data-toggle="tab">按地区</a></li>
        <li><a href="#customerRanking" data-toggle="tab">按客户</a></li>
        <li><a href="#salesManRanking" data-toggle="tab">按业务员</a></li>
        <li><a href="#productRanking" data-toggle="tab">按产品</a></li>
    </ul>
    <ul class="breadcrumb pull-right">
        <li><span class="glyphicon glyphicon-map-marker"></span></li>
    </ul>
</div>
<div class="dashboard-wrapper">
    <div class="row">
        <div class="col-xs-12">
            <div class="panel panel-default view-HD-lg">
                <div class="panel-body clearfix">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <div class="col-xs-5 pull-right">
                                <!--搜索栏-->
                                <form class="input-group">
                                    <span class="input-group-addon" lang="zh">开始时间</span>
                                    <input class="form-control" id="startTime" type="date"/>
                                    <span class="input-group-addon" lang="zh">结束时间</span>
                                    <input class="form-control" id="endTime" type="date"/>
                                    <div class="input-group-btn">
                                        <button class="btn btn-xs btn-primary" type="reset">重置</button>
                                        <button class="btn btn-xs btn-primary" id="submit" type="button">搜索</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content">
                        <div id="areaRanking" class="tab-pane fade in active">
                            <div class="row">
                                <div class="col-xs-2">
                                    <select class="form-control" id="dimension">
                                        <option value="0" lang="zh"><a href="#areaRanking" data-toggle="tab">地区分类排名</a></option>
                                        <option value="1" lang="zh"><a href="#countryRanking" data-toggle="tab">国家排名</a> </option>
                                    </select>
                                </div>
                            </div>
                            <table class="table table-bordered table-condensed table-striped text-center">
                                <caption class="text-right"><span lang="zh">金额单位：万元</span></caption>
                                <thead>
                                <tr>
                                    <th class="text-center text-middle">编号</th>
                                    <th class="text-center text-middle">地区分类</th>
                                    <th class="text-center text-middle">销售额</th>
                                    <th class="text-center text-middle">销售最低限价</th>
                                    <th class="text-center text-middle">营销成本</th>
                                    <th class="text-center text-middle">净利润</th>
                                    <th class="text-center text-middle">排名</th>
                                    <th class="text-center text-middle">地区内国家排名明细</th>
                                </tr>
                                </thead>
                                <tbody id="areaDimension"></tbody>

                            </table>
                        </div>
                        <div id="customerRanking" class="tab-pane fade">
                            <!--客户排名开始-->
                            <table class="table table-bordered table-condensed text-center table-striped">
                                <caption class="text-right"><span lang="zh">金额单位：万元</span></caption>
                                <thead>
                                <tr>
                                    <th class="text-center text-middle">编号</th>
                                    <th class="text-center text-middle">客户全称</th>
                                    <th class="text-center text-middle">国家</th>
                                    <th class="text-center text-middle">地区分类</th>
                                    <th class="text-center text-middle">销售额</th>
                                    <th class="text-center text-middle">销售最低限价</th>
                                    <th class="text-center text-middle">营销成本</th>
                                    <th class="text-center text-middle">净利润</th>
                                    <th class="text-center text-middle">排名</th>
                                    <th class="text-center text-middle">业务员</th>
                                </tr>
                                </thead>
                                <tbody id="customerDimension"></tbody>
                            </table>
                            <!--客户排名-->
                        </div>
                        <div id="salesManRanking" class="tab-pane fade">
                            <!--业务员排名开始-->
                            <table class="table table-bordered table-condensed text-center table-striped">
                                <caption class="text-right"><span lang="zh">金额单位：万元</span></caption>
                                <thead>
                                <tr>
                                    <th class="text-center text-middle">编号</th>
                                    <th class="text-center text-middle">业务员</th>
                                    <th class="text-center text-middle">国家</th>
                                    <th class="text-center text-middle">销售额</th>
                                    <th class="text-center text-middle">销售最低限价</th>
                                    <th class="text-center text-middle">营销成本</th>
                                    <th class="text-center text-middle">净利润</th>
                                    <th class="text-center text-middle">排名</th>
                                    <th class="text-center text-middle">客户利润明细</th>
                                </tr>
                                </thead>
                                <tbody id="salesManDimension"></tbody>
                            </table>
                            <!--业务员排名结束-->
                        </div>
                        <div id="productRanking" class="tab-pane fade">
                            <!--产品排名开始-->
                            <table class="table table-bordered table-condensed text-center table-striped">
                                <caption class="text-right"><span lang="zh">金额单位：万元</span></caption>
                                <thead>
                                <tr>
                                    <th class="text-center text-middle">编号</th>
                                    <th class="text-center text-middle">产品名称</th>
                                    <th class="text-center text-middle">产品种类</th>
                                    <th class="text-center text-middle">销售量</th>
                                    <th class="text-center text-middle">销售额</th>
                                    <th class="text-center text-middle">销售最低限价</th>
                                    <th class="text-center text-middle">营销成本</th>
                                    <th class="text-center text-middle">净利润</th>
                                    <th class="text-center text-middle">排名</th>
                                    <th class="text-center text-middle">毛利率（%）</th>
                                </tr>
                                </thead>
                                <tbody id="productDimension"></tbody>
                            </table>
                            <!--产品排名结束-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<input id="dimensionP" type="hidden" value="0">

<script type="text/javascript" src="${request.contextPath}/lib/js/pagination/pagination.js"></script>
<link rel="stylesheet" type="text/css" href="${request.contextPath}/lib/js/pagination/pagination.css" />
<script type="text/javascript" language="javascript" src="${request.contextPath}/lib/js/creatTree.js"></script>
<script type="text/javascript">
    var pageSize = 3;

    $(document).ready(function(){
        //搜索按钮绑定事件
//        $("#submit").click(function(){
//            serach();
//        });
        //默认查询数据
        serach(0);
    })

    //查询按钮提交数据
    function serach(dimension){
        var total = getListCount(dimension);
        getDataList(0,null,dimension);
        $("#pagination").pagination(total,{
            items_per_page : pageSize,
            num_edge_entries : 3,
            num_display_entries : 10,
            callback:getDataList
        });
    }
    var customerLevelList = ['战略客户','大客户' ,'重要客户' ,'一般客户' ,'风险客户'];

    $('#myTab').on('click.get', 'a', function (e) {
        var el = $(e.target);
        if (el.attr('href')==='#productRanking') {
            $('#dimensionP').val(4);
            serach(4);
        }else if(el.attr('href')==='#areaRanking'){
            $('#dimensionP').val(0);
            serach(0);
        }else if(el.attr('href')==='#countryRanking'){
            serach(1);
        }else if(el.attr('href')==='#customerRanking'){
            $('#dimensionP').val(2);
            serach(2);
        }else if(el.attr('href')==='#salesManRanking'){
            $('#dimensionP').val(3);
            serach(3);
        }
    });

     //地区分类change事件
    $('#dimension').on('change',function (e) {
        var val = $('#dimension').find('option').filter(':selected').val();
        serach(val);
    });

    //点击搜索
    $('#submit').on('click',function () {
        serach( $('#dimensionP').val());
    });

    //根据页码获取列表数据
    function getDataList(pageNum,jq,dimension){
        var data = {
            startTime:$('#startTime').val(),
            endTime:$('#endTime').val(),
            startRow:pageNum*pageSize,
            pageSize:pageSize,
            dimension:dimension

        };
        jQuery.ajax({
            url: basePath + '/businessOrder/getProfitStatisticsByPage',
            dataType:'json',
            async:true,
            method:'POST',
            contentType:"application/json",
            data:JSON.stringify(data),
            success:function(data){
                var ResultData = data.data;
                var _html = '';
                if(dimension==4) {
                    if (ResultData && ResultData != '' && ResultData != 'null') {
                        for (var i = 0; i < ResultData.length; i++) {
                            _html += '<tr>';
                            _html += '	<td>' + ResultData[i].businessId + '</td>';
                            _html += '  <td><a href="">' + ResultData[i].productName + '</a></td>';
                            _html += '  <td>' + ResultData[i].categoryName + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].salesVolume + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].grossProfit + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].grossMargin + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].salesAmount + '</td>';
                            _html += '   </tr>';
                        }
                    }
                    $("#productDimension").html(_html);
                }else if(dimension==0){
                    if (ResultData && ResultData != '' && ResultData != 'null') {
                        for (var i = 0; i < ResultData.length; i++) {
                            _html += '<tr>';
                            _html += '	<td>' + ResultData[i].businessId + '</td>';
                            _html += '  <td><a href="">' + ResultData[i].customerArea + '</a></td>';
                            _html += '  <td>' + ResultData[i].categoryName + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].salesAmount + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].grossProfit + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].maintenanceFee + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].netProfit + '</td>';
                            _html += '   </tr>';
                        }
                    }
                    $("#areaDimension").html(_html);
                }
                else if(dimension==1){
                    if (ResultData && ResultData != '' && ResultData != 'null') {
                        for (var i = 0; i < ResultData.length; i++) {
                            _html += '<tr>';
                            _html += '	<td>' + ResultData[i].businessId + '</td>';
                            _html += '	<td>' + ResultData[i].country + '</td>';
                            _html += '  <td><a href="">' + ResultData[i].customerArea + '</a></td>';
                            _html += '  <td lang="zh">' + ResultData[i].salesAmount + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].grossProfit + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].maintenanceFee + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].netProfit + '</td>';
                            _html += '   </tr>';
                        }
                    }
                    $("#countryDimension").html(_html);
                }
                else if(dimension==2){
                    if (ResultData && ResultData != '' && ResultData != 'null') {
                        for (var i = 0; i < ResultData.length; i++) {
                            _html += '<tr>';
                            _html += '	<td>' + ResultData[i].businessId + '</td>';
                            _html += '	<td>' + ResultData[i].customerName + '</td>';
                            _html += '	<td>' + ResultData[i].country + '</td>';
                            _html += '  <td><a href="">' + ResultData[i].customerArea + '</a></td>';
                            _html += '  <td lang="zh">' + ResultData[i].salesAmount + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].grossProfit + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].maintenanceFee + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].netProfit + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].salesManName + '</td>';
                            _html += '   </tr>';
                        }
                    }
                    $("#customerDimension").html(_html);
                }
                else if(dimension==3){
                    if (ResultData && ResultData != '' && ResultData != 'null') {
                        for (var i = 0; i < ResultData.length; i++) {
                            _html += '<tr>';
                            _html += '	<td>' + ResultData[i].businessId + '</td>';
                            _html += '	<td>' + ResultData[i].salesManName + '</td>';
                            _html += '  <td><a href="">' + ResultData[i].customerArea + '</a></td>';
                            _html += '  <td lang="zh">' + ResultData[i].salesAmount + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].grossProfit + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].maintenanceFee + '</td>';
                            _html += '  <td lang="zh">' + ResultData[i].netProfit + '</td>';
                            _html += '   </tr>';
                        }
                    }
                    $("#salesManDimension").html(_html);
                }
            }
        });
    }

    /*分页插件参数
    参数名	描述	参数值
    maxentries	总条目数	必选参数，整数
    items_per_page	每页显示的条目数	可选参数，默认是10
    num_display_entries	连续分页主体部分显示的分页条目数	可选参数，默认是10
    current_page	当前选中的页面	可选参数，默认是0，表示第1页
    num_edge_entries	两侧显示的首尾分页的条目数	可选参数，默认是0
    link_to	分页的链接	字符串，可选参数，默认是"#"
    prev_text	“前一页”分页按钮上显示的文字	字符串参数，可选，默认是"Prev"
    next_text	“下一页”分页按钮上显示的文字	字符串参数，可选，默认是"Next"
    ellipse_text	省略的页数用什么文字表示	可选字符串参数，默认是"..."
    prev_show_always	是否显示“前一页”分页按钮	布尔型，可选参数，默认为true，即显示“前一页”按钮
    next_show_always	是否显示“下一页”分页按钮	布尔型，可选参数，默认为true，即显示“下一页”按钮
    callback	回调函数	默认无执行效果*/

    /**
     * 获取列表数据总条目数
     */
    function getListCount(dimension){
        var total = 0;
        var data = {
            startTime:$('#startTime').val(),
            endTime:$('#endTime').val(),
            dimension:dimension
        }
        jQuery.ajax({
            url:basePath + '/businessOrder/countProfitStatistics',
            dataType:'JSON',
            async:false,
            method:'POST',
            contentType:"application/json",
            data:JSON.stringify(data),
            success:function(data){
                total = data.data;
            }
        });
        return total;
    }
</script>
