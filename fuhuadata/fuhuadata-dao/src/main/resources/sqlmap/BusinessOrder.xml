<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
        "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="BusinessOrder">
    <typeAlias alias="BusinessOrder" type="com.fuhuadata.domain.BusinessOrder"/>
    <typeAlias alias="QueryBusinessOrder" type="com.fuhuadata.domain.query.QueryBusinessOrder"/>

    <sql id="QUERY-COMMON">
        <dynamic prepend=" WHERE ">
            <isNotEmpty prepend=" AND " property="customerId">
                customer_id = #customerId#
            </isNotEmpty>
            <isNotEmpty prepend=" AND " property="status">
                status = #status#
            </isNotEmpty>
            <isNotEmpty prepend=" AND " property="saleOrganizationId">
                sale_organization_id = #saleOrganizationId#
            </isNotEmpty>
            <isNotEmpty prepend=" AND " property="ncOrderId">
                nc_order_id =  #ncOrderId#
            </isNotEmpty>
            <isNotEmpty prepend=" AND " property="startTime">
                <![CDATA[
                     deal_time  >=  #startTime#
                ]]>
            </isNotEmpty>
        </dynamic>
    </sql>

    <select id="query_page" parameterClass="QueryBusinessOrder" resultClass="BusinessOrder">
        select
                sale_organization_name saleOrganizationName,
                order_id orderId,
                nc_order_id ncOrderId,
                amount_payable amountPayable,
                floor_price floorPrice,
                is_complaint isComplaint,
                is_modify_price isModifyPrice,
                net_profit netProfit,
                is_pledge isPledge,
                deal_time dealTime
        from
                business_order
        <isParameterPresent>
            <include refid="QUERY-COMMON"/>
            <isNotEmpty prepend=" AND " property="orderBy">
                order by $orderBy$
            </isNotEmpty>
            limit #startRow#,#pageSize#
        </isParameterPresent>
    </select>

    <select id="count" parameterClass="QueryBusinessOrder" resultClass="java.lang.Integer">
        select count(*) from business_order
        <isParameterPresent>
            <include refid="QUERY-COMMON"/>
        </isParameterPresent>
    </select>

</sqlMap>