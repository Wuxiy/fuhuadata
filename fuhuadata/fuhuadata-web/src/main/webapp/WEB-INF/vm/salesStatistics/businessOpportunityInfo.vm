
<div class="nav-deputy shadow-out clearfix">
    <ul id="myTab" class="nav nav-tabs pull-left">
        <li class="active"><a href="#Baseinfo" data-toggle="tab">基础信息</a></li>
        <li><a href="#Packrelate" data-toggle="tab">跟进记录</a></li>
    </ul>
    <ul class="breadcrumb pull-right">
        <li><span class="glyphicon glyphicon-map-marker"></span></li>
    </ul>
</div>
    <div class="dashboard-wrapper">
        <div class="row">
            <div class="col-xs-12">
                <!--基本信息-->
                <div id="Baseinfo" class="tab-pane fade in active">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="btn-group btn-group-xs panel-heading-btn pull-right">
                                <button id="edit" data-form-btn="edit" class="btn btn-xs btn-primary panel-heading-btn pull-right" type="button" lang="zh">
                                    编辑
                                </button>
                                <a class="btn btn-primary" href="" target="_blank">报价</a>
                            </div>
                            <div class="but-group btn-group btn-group-xs panel-heading-btn pull-right hidden">
                                <a id="cancel" data-form-btn="cancel" class="btn" lang="zh">取消</a>
                                <a id="save" data-form-btn="save" class="btn btn-primary" lang="zh">保存</a>
                            </div>
                            <h3 class="panel-title" lang="zh">
                                基本信息
                            </h3>
                        </div>
                        <div class="panel-body clearfix">
                            <div class="form-horizontal">
                                <div class="form-group ">
                                    <label class="col-xs-1 control-label" lang="zh">商机名称<sup class="not-null">*</sup></label>
                                    <div class="col-xs-2">
                                        <input class="form-control notnull" type="text" value="" id="businessName" disabled />
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">商机编号</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="text" value="" id="businessId" disabled />
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">商机来源<sup class="not-null">*</sup></label>
                                    <div class="col-xs-2">
                                        <select class="form-control notnull" id="businessFrom" disabled>
                                            <option value="0" selected lang="zh">展会</option>
                                            <option value="1" lang="zh">门户网站</option>
                                            <option value="2" lang="zh">农药店考察</option>
                                            <option value="3" lang="zh">客户介绍</option>
                                            <option value="4" lang="zh">主动联系</option>
                                            <option value="5" lang="zh">其他</option>
                                        </select>
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">商机状态</label>
                                    <div class="col-xs-2">
                                        <select class="form-control" id="businessState" disabled>
                                            <option value="0" lang="zh">待报价</option>
                                            <option value="1" lang="zh">失败</option>
                                            <option value="2" lang="zh">已转化</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group ">
                                    <label class="col-xs-1 control-label" lang="zh">客户名称<sup class="not-null">*</sup></label>
                                    <div class="col-xs-2">
                                        <input class="form-control notnull" type="text" value="" id="customerName" disabled />
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">企业性质</label>
                                    <div class="col-xs-2">
                                        <select class="form-control" id="enterpriseNature" disabled>
                                            <option value="1" selected lang="zh">工厂</option>
                                            <option value="2" lang="zh">分销商</option>
                                            <option value="3" lang="zh">经销商</option>
                                            <option value="4" lang="zh">终端客户</option>
                                            <option value="5" lang="zh">其他</option>
                                        </select>
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">客户类型</label>
                                    <div class="col-xs-2">
                                        <select class="form-control" id="customerLevel" disabled>
                                            <option value="" lang="zh">潜在客户</option>
                                            <option value="5" lang="zh">风险客户</option>
                                            <option value="4" lang="zh">一般客户</option>
                                            <option value="3" lang="zh">重要客户</option>
                                            <option value="2" lang="zh">大客户</option>
                                            <option value="1" selected lang="zh">战略客户</option>
                                        </select>
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">信用评级</label>
                                    <div class="col-xs-2">
                                        <select class="form-control" id="zhongxinbaoLevel" disabled>
                                            <option value="" selected lang="zh">AAAA</option>
                                            <option value="" lang="zh">AAA</option>
                                            <option value="" lang="zh">AA</option>
                                            <option value="" lang="zh">A</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-xs-1 control-label" lang="zh">客户国别</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="text" value="" id="country" disabled />
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">联系人</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="text" value="" id="name" disabled />
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">联系电话</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="text" value="" id="linkPhone1" disabled />
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">邮箱</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="email" value="lemail" id="" disabled />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-xs-1 control-label" lang="zh">意向产品1</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="text" value="" id="intentionalProduct0" disabled />
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">预计采购量1</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="text" value="" id="estimatedPurchase0" disabled />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-xs-1 control-label" lang="zh">意向产品2</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="text" value="" id="intentionalProduct1" disabled />
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">预计采购量2</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="text" value="" id="estimatedPurchase1" disabled />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-xs-1 control-label" lang="zh">预计收益</label>
                                    <div class="col-xs-2">
                                        <div class="input-group">
                                            <input class="form-control" type="text" value="" id="expectIncome" disabled/>
                                            <span class="input-group-addon">万元</span>
                                        </div>
                                    </div>
                                    <label class="col-xs-1 control-label" lang="zh">预计截止日期</label>
                                    <div class="col-xs-2">
                                        <input class="form-control" type="text" value="" id="deadline" disabled />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-xs-1 control-label" lang="zh">商机描述</label>
                                    <div class="col-xs-8">
                                        <textarea class="form-control " rows="3" lang="zh" id="businessDescribe" disabled>客户主要销售草甘膦系列产品，有原药采购需求</textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-xs-1 control-label" lang="zh">备注</label>
                                    <div class="col-xs-8">
                                        <textarea class="form-control " rows="3" lang="zh" id="businessRemarks" disabled></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="" class="col-xs-1 control-label" lang="zh">创建人</label>
                                    <div class="col-xs-2">
                                        <input type="text" class="form-control" value="" id="createUserName" disabled/>
                                    </div>
                                    <label for="" class="col-xs-1 control-label" lang="zh">创建日期</label>
                                    <div class="col-xs-2">
                                        <input type="data" class="form-control" value="" id="createTime" disabled/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--商机跟进-->
                <div id="Packrelate" class="tab-pane fade">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a data-toggle="modal" data-target="#updateProgress" class="btn btn-xs btn-primary panel-heading-btn pull-right" href="#" lang="zh">新增</a>
                            <h3 class="panel-title" lang="zh">商机跟进</h3>
                        </div>
                        <div class="panel-body clearfix">
                            <table class="table table-condensed table-bordered table-striped text-center">
                                <thead>
                                <tr>
                                    <th class="text-center" lang="zh">编号</th>
                                    <th class="text-center" lang="zh">跟进内容</th>
                                    <th class="text-center" lang="zh">跟进效果</th>
                                    <th class="text-center" lang="zh">商机阶段</th>
                                    <th class="text-center" lang="zh">创建人</th>
                                    <th class="text-center" lang="zh">创建时间</th>
                                </tr>
                                </thead>
                                <tbody id="businessfollow">
                                <tr>
                                    <td>1</td>
                                    <td>获取客户联系人和联系方式</td>
                                    <td>与联系人进行沟通约定时间洽谈</td>
                                    <td>线索跟进</td>
                                    <td>刘凯洋</td>
                                    <td>2016-10-10 18:00</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<input type="hidden" id="businessId" value="${businessId}" />
<script type="text/javascript" language="javascript" src="${request.contextPath}/lib/js/commons/common.js"></script>
<script type="text/javascript" language="javascript" src="${request.contextPath}/lib/js/commons/ajax.js"></script>
<script type="text/javascript" language="javascript" src="${request.contextPath}/lib/js/customer/common.js"></script>
<script type="text/javascript" lang="javascript">
    var businessId = $('#businessId').val();

    $(document).ready(function(){
        //获取信息
        getData(basePath + '/businessInfo/getBusinessInfoById','POST',businessId,businessInfo);

        //编辑商机基本信息
        $(document).on('click.edit','#edit',function () {
        });
        //商机基本信息提交
        $(document).on('click.up','#save',function(){
            var notnull = $('.notnull');
            var submit_permit = true;
            notnull.each(function () {
                var val = $(this).val();
                if(val == ''||val == null){
                    alert('请完善表单必填项');
                    submit_permit = false;
                    return false;
                }
            });
            if(submit_permit){
                upData(basePath+'/customerLinkman/updateBusinessInfoById','POST',updateBusinessInfo(),"application/json");
            }
        });
        //客户基本信息取消提交
        $(document).on('click.cancel','#cancel',function(){
            location.reload();
        });
    })

    //获取详情function
    function businessInfo(result) {
        var ResultData = result.data;
        var businessfollow = result.businessfollow;
        console.log(ResultData);

        var intentionalProducts = ResultData.intentionalProducts;
        $('#intentionalProduct0').val(intentionalProducts[0].intentionalProduct);
        $('#intentionalProduct1').val(intentionalProducts[1].intentionalProduct);
        $('#estimatedPurchase0').val(intentionalProducts[0].estimatedPurchase);
        $('#estimatedPurchase1').val(intentionalProducts[1].estimatedPurchase);

        $('#businessName').val(ResultData.businessName);
        $('#businessId').val(ResultData.businessId);
        $('#businessFrom').val(ResultData.businessFrom);
        $('#businessState').val(ResultData.businessState);
        $('#customerName').val(ResultData.customerName);
        $('#enterpriseNature').val(ResultData.enterpriseNature);
        $('#customerLevel').val(ResultData.customerLevel);
        $('#zhongxinbaoLevel').val(ResultData.zhongxinbaoLevel);
        $('#country').val(ResultData.country);
        $('#name').val(ResultData.name);
        $('#linkPhone1').val(ResultData.linkPhone1);
        $('#lemail').val(ResultData.lemail);
        $('#expectIncome').val(ResultData.expectIncome);
        $('#deadline').val(ResultData.deadline);
        $('#businessDescribe').val(ResultData.businessDescribe);
        $('#businessRemarks').val(ResultData.businessRemarks);
        $('#createUserName').val(ResultData.createUserName);
        $('#createTime').val(ResultData.createTime);

        var _html = '';
        for(var i=0;i<businessfollow.length;i++){
            _html += '<tr>';
            _html += '<td>'+businessfollow[i].name+'</td>';
            _html += '<td>'+businessfollow[i].name+'</td>';
            _html += '<td>'+businessfollow[i].name+'</td>';
            _html += '<td>'+businessfollow[i].name+'</td>';
            _html += '<td>'+businessfollow[i].name+'</td>';
            _html += '<td>'+businessfollow[i].name+'</td>';
            _html += '</tr>';
        }
        $('#businessfollow').append(_html);
    }

    function updateBusinessInfo(){
        var data = {
            "bussinessId":$('#businessId').val(),
            "bussinessName":$('#bussinessName').val(),
            "businessId":$('#businessId').val(),
            "businessFrom":$('#businessFrom').val(),
            "businessState":$('#businessState').val(),
            "customerName":$('#customerName').val(),
            "enterpriseNature":$('#enterpriseNature').val(),
            "customerLevel":$('#customerLevel').val(),
            "zhongxinbaoLevel":$('#zhongxinbaoLevel').val(),
            "country":$('#country').val(),
            "name":$('#name').val(),
            "linkPhone1":$('#linkPhone1').val(),
            "lemail":$('#lemail').val(),
            "expectIncome":$('#expectIncome').val(),
            "deadline":$('#deadline').val(),
            "businessDescribe":$('#businessDescribe').val(),
            "businessRemarks":$('#businessRemarks').val(),
            "createUserName":$('#createUserName').val(),
            "createTime":$('#createTime').val(),
            "intentionalProducts":getintentionalProducts()
        }

        return JSON.stringify(data);
    }
    
    function getintentionalProducts() {
        var data = [
            {
                "intentionalProduct":$('#intentionalProduct0').val(),
                "estimatedPurchase":$('#estimatedPurchase0').val()
            },
            {
                "intentionalProduct":$('#intentionalProduct1').val(),
                "estimatedPurchase":$('#estimatedPurchase1').val()
            }
        ]
        return JSON.stringify(data);
    }
</script>
