#set($layout="layout/layout.vm")
<div class="nav-deputy shadow-out clearfix">
    <ul class="breadcrumb pull-right">
        <li><span class="glyphicon glyphicon-map-marker"></span></li>
    </ul>
</div>

<div class="dashboard-wrapper">
    <div class="row">
        <div class="col-xs-12">
            <!--表格开始-->
            <div class="panel panel-default">
                <div class="panel-heading">
                    #if ($shiro.hasPermission("wiki:state:add"))
                        <a class="btn btn-xs btn-primary pull-right panel-heading-btn"
                           href="${request.contextPath}/exhibitionInfo/addExhibitionInfo" data-toggle="modal">
                            <span class="glyphicon glyphicon-plus"></span>
                            新增
                        </a>
                    #end
                    <h3 class="panel-title">
                        展会动态
                    </h3>
                </div>
                <div class="panel-body clearfix">

                    <!--表格开始-->
                    <table id="exhibition_table" class="display table table-condensed table-bordered table-striped"
                           cellspacing="0" width="100%">
                        <thead>
                        <tr>
                            <th class="text-center text-middle">编号</th>
                            <th class="col-xs-2 text-center text-middle">展会名称</th>
                            <th class="col-xs-1 text-center text-middle">主办方</th>
                            <th class="col-xs-2 text-center text-middle">承办单位</th>
                            <th class="text-center text-middle">国家</th>
                            <th class="text-center text-middle">城市</th>
                            <th class="col-xs-1 text-center text-middle">开始时间</th>
                            <th class="col-xs-1 text-center text-middle">结束日期</th>
                            <th class="col-xs-1 text-center text-middle">展会地址</th>
                            <th class="col-xs-2 text-center text-middle">展会介绍</th>
                            <th class="col-xs-1 text-center text-middle">展会介绍连接</th>
                            <th class="text-center">创建人</th>
                            <th class="col-xs-1 text-center text-middle">创建时间</th>
                            <th >操作</th>
                        </tr>
                        </thead>

                    </table>
                    <!--表格结束-->
                    <!--分页导航开始-->
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {

        var datatale = $('#exhibition_table').DataTable({

            "ajax": '${request.contextPath}/exhibitionInfo/queryExhibitionInfoList',
            "pagingType": "full_numbers",
            "lengthMenu": [[5, 10, 15, -1], [5, 10, 15, "All"]],
            "columns": [
                {"data": "exhibitionId"},
                {"data": "exhibitionName"},
                {"data": "sponsor"},
                {"data": "organizer"},
                {"data": "country"},
                {"data": "city"},
                {"data": "startDate"},
                {"data": "finishDate"},
                {"data": "exhibitionAddr"},
                {"data": "exhibitionInfo"},
                {"data": "exhibitionLink"},
                {"data": "creator"},
                {"data": "createTime"},
                {
                    data: 'exhibitionId',
                    render: function (data, type, row, meta) {
                        var delBtn = '<a href="#" class="j-delete" data-id="' + data + '">删除</a>';
                        return delBtn;
                    }
                }
            ],
            "columnDefs": [{
                targets: '_all',
                defaultContent: ''
            }, {
                "targets": 10,
                "render": function (data, type, row, meta) {
                    return '<a href="' + data + '" target="_blank">' + data + '</a>';
                }
            }, {
                "targets": 1,
                "render": function (data, type, row, meta) {
                    return '<a href="${request.contextPath}/exhibitionInfo/modifyExhibitionInfo?id=' + row.exhibitionId + '" target="_blank">' + data + '</a>';
                }
            }],
            "language": {
                "url": '${request.contextPath}/lib/dataTables/lang/dataTables.lang.zh',
                "searchPlaceholder": '关键字'
            }
        });

        // 删除
        $(document).on('click', '.j-delete', function (e) {
            var jbtn = $(e.target),
                jtr = jbtn.closest('tr'),
                id = jbtn.data("id");

            if (confirm("确认删除该展会动态？")) {
                var url = '${rc.contextPath}/exhibitionInfo/deleteExhibitionInfo';
                $.post(url, {
                    id: id
                }, function (result) {
                    if (result.code == 1) {
                        alert("删除成功！");
                        datatale.row(jtr).remove();
                        datatale.ajax.reload(null, false);
                    } else {
                        alert("删除失败！");
                    }
                });
            }

            return false;
        });

    });


</script>
