
<div class="clearfix content shadow-out">
    <!--面包屑导航-->
    <div class="nav-deputy shadow-out clearfix">
        #breadcrumb()
    </div>
    <div class="dashboard-wrapper">
        <div class="row">
            <div class="col-xs-12 view-HD-lg">
                <!--加工成分-->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title" lang="zh">订单转化</h3>
                    </div>
                    <div class="panel-body clearfix">
                        <div class="form-horizontal">
                            <div class="form-group ">
                                <label class="col-xs-1 control-label" lang="zh">订单编号</label>
                                <div class="col-xs-3">
                                    <input data-val="$!{businessOrderProduct.businessOrderProducts}" class="form-control" type="text" id="orderId" value="$!{orderId}" disabled />
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="panel-body clearfix col-xs-offset-1">
                                    <table class="table table-condensed table-bordered table-striped text-center">
                                        <thead>
                                        <tr>
                                            <th class="text-center col-xs-6" lang="zh">商机产品</th>
                                            <th class="text-center col-xs-2" lang="zh">最低销售价（元）</th>
                                            <th class="text-center col-xs-2" lang="zh">是否转化</th>
                                            <th class="text-center col-xs-2" lang="zh">合同单价（元）</th>
                                        </tr>
                                        </thead>
                                        <tbody id="conversiontable">
                                        #if($!{businessOrderProduct})
                                            #foreach($info in $!{businessOrderProduct.businessOrderProducts})
                                            <tr name="item">
                                                <td>$!info.name</td>
                                                <td>$!info.minPrice</td>
                                                <td><input name="checkItem" type="checkbox" #if($!info.transformState==0) checked #end value="1"/></td>
                                                <td><input name="onePrice" class="form-control" type="number" /></td>
                                            </tr>
                                            #end
                                        #end
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <td class="text-danger">产品总价</td>
                                            <td></td>
                                            <td></td>
                                            <td class="text-danger" id="totalPrice"></td>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-2 col-xs-offset-4">
                    <a class="btn btn-block btn-primary" id="finish">转化</a>
                </div>
                <div class="col-xs-2">
                    <button class="btn btn-block btn-default" type="reset">取消</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" language="javascript" src="${request.contextPath}/lib/js/commons/common.js"></script>
<script type="text/javascript" language="javascript" src="${request.contextPath}/lib/js/commons/ajax.js"></script>
<script type="text/javascript" language="JavaScript">


    $(document).ready(function(){
<<<<<<< HEAD
        console.log(orderId)
        jQuery.ajax({
            url:basePath + '' + orderId,
            type:'POST',
            data:'',
            success:function(result){
                conversiontable.innerHTML = '';
                for(var i=0;i<result.length;i++){
                    var ResultData = result[i];
                    conversiontable.innerHTML += '<tr>' +
                                    '<td>'+ResultData.name+'</td>'+
                                    '<td>'+ResultData.name+'</td>'+
                                    '<td><input type="checkbox" name="cellcheckbox" value="'+ResultData.businessProductId+'">'+ResultData.name+'</td>'+
                                    '<td><input class="form-control" type="text" value="'+ResultData.name+'"></td>'+
                                    '</tr>';
                }
            }
        })
=======

        $(document).on('input.cc','input[name="onePrice"]',function () {
            var total = 0;

            $('input[name="checkItem"]').filter(':checked').closest('tr')
                    .find('input[name="onePrice"]').each(function () {
                var oneItem = $(this).val()!=''?$(this).val():0;

                total += parseInt(oneItem);
            });

            $('#totalPrice').text(total);
        });

        $(document).on('click.cc','input[name="checkItem"]',function () {
            var total = 0;
>>>>>>> 3f7afdc56810a4d781e92ed0bab943b975a54346

            $('input[name="checkItem"]').filter(':checked').closest('tr')
                    .find('input[name="onePrice"]').each(function () {
                var oneItem = $(this).val()!=''?$(this).val():0;

                total += parseInt(oneItem);
            });

            $('#totalPrice').text(total);
        });

        var orderId = $('#orderId').val();
        var conversiontable = $('#conversiontable').val();
    })

    //


    $('#finish').click(function(){
        jQuery.ajax({
            url:basePath + '',
            type:'POST',
            data:getIds(),
            success:function(result){
                console.log(result);
            }
        })
    });

    function getIds() {
        var ids = new Array();
        $("input[name='cellcheckbox']:checked").each(function(){
            ids.push($(this).val());
        })
        return ids;
    }
</script>